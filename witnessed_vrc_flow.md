# Witnessed Session-Based VRC Exchange (Early Draft, v0.2)

There are a variety of important use cases for **Witnessed** Decentralized Trust Graph exchanges.

A trusted "fair witness," authorized by an overarching organization or trust community (by virtue of possession of an appropriate Community Credential), can lend legitimacy to Relationship Credential (VRC) exchanges by attesting to them in real-time. *A trusted witness might be a human, or might be an agent or bot authorized by the organization to perform this function.*

**Use Cases:**

- **Events** (e.g., conferences, classes): An on-site bot or docent witnesses an in-person VRC exchange to confirm that the participants were physically present in the same space (proximity-bound credentials).
- **Virtual Real-Time Exchange:** An authorized agent witnesses a virtual handshake between two humans to prevent "man-in-the-middle" or asynchronous spoofing.
- **Verifiable "Check-ins":** A witness confirms a user was active in a specific virtual session at a specific time.

## Terminology

- **Requester:** The entities (Alice and Bob) desiring a witnessed exchange.
- **Witness:** An entity (human or bot) authorized to issue **Witness Credentials (VWC)**.
- **Session Context:** A temporal window defined by a cryptographic challenge (nonce) generated by the Witness.
- **Wrapping Protocol:** The method of using a *Verifiable Presentation (VP)* to bind a standard credential to a specific session challenge.

## Witnessed VRC Session Flow (Alice, Bob, and Witness)

This flow utilizes standard **VRCs** (Relationship Credentials) and **VWCs** (Witness Credentials). The "Session" is enforced via the **Verifiable Presentation** layer so that the credentials themselves can be kept simple and clean.

### 1. Session Creation (The Handshake)

1. **Session Request:**
    **Alice** (or **Bob**) sends a `session-request` message to **Witness**, asking them to witness a mutual relationship exchange.

2. **Session Initialization:**
    **Witness** confirms availability and generates a unique **Session Challenge** (a cryptographic nonce, e.g., `session-ID-8822-nonce`).

3. **Session Challenge:**
    **Witness** sends a `request-presentation` message to both **Alice** and **Bob**.
    - **Payload:** Includes the `challenge` string and the `domain` (context).
    - **Instruction:** "Sign a Verifiable Presentation containing your VRC using this challenge."

### 2. Credential Creation & Wrapping (The Binding)

*Crucially, Alice and Bob do not modify the VRC schema. They bind the context using the Presentation layer.*

1. **Bob's Action:**
    - **Mints VRC:** Bob's agent generates a standard [VRC](./vrc.md) targeting Alice (`issuer: Bob`, `subject: Alice`).
    - **Wraps in VP:** Bob creates a Verifiable Presentation containing this VRC.
    - **Signs VP:** Bob signs the **Presentation** using the **Witness's Challenge** in the proof block.
    - **Submits:** Bob sends the VP to **Witness** via a `submit-presentation` message.

2. **Alice's Action:**
    - **Mints VRC:** Alice's agent generates a standard [VRC](./vrc.md) targeting Bob (`issuer: Alice`, `subject: Bob`).
    - **Wraps in VP:** Alice creates a Verifiable Presentation containing this VRC.
    - **Signs VP:** Alice signs the **Presentation** using the **Witness's Challenge** in the proof block.
    - **Submits:** Alice sends the VP to **Witness** via a `submit-presentation` message.

### 3. Witness Verification & Endorsement

**Witness** observes the incoming presentations in real-time. For each submission, the Witness Agent performs a three-step check:

1. **Context Check:** Verifies the **VP Signature** matches the `challenge` (nonce) the Witness generated. *This proves Alice and Bob are active in the current session.*
2. **Identity Check:** Verifies the inner **VRC Signature** belongs to the issuer.
3. **Freshness Check:** Verifies the inner VRC `validFrom` timestamp is within the acceptable session tolerance (e.g., +/- 5 minutes of current time).

**Issuance:**
Upon successful verification, **Witness** mints two [Witness Credentials (VWC)](./vwc.md):

- **VWC A:** Attesting that *Witness* observed *Bob's VRC*.
- **VWC B:** Attesting that *Witness* observed *Alice's VRC*.

These VWCs explicitly list the `sessionID` or Context Name in their subject data.

### 4. Credential Distribution

**Witness** sends a `witness-grant` message to the participants:

- Sends **VWC A** (witnessing Bob) to **Alice**.
- Sends **VWC B** (witnessing Alice) to **Bob**.
- *(Optional)* Witness may also forward the underlying VRCs if Alice and Bob haven't exchanged them directly yet.

### 5. Verification

At the end of this flow, Alice and Bob possess a rigorous set of proofs:

1. **The VRC:** The standard relationship claim from the counterparty.
2. **The VWC:** A third-party attestation proving the VRC was generated during the specific session.

**Alice** can now prove to a verifier: *"I have a relationship with Bob (VRC), and this relationship was established in-person at the 2024 Conference, as verified by the Conference Bot (VWC)."*
